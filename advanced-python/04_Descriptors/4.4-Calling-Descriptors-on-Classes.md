# 4.4 Calling Descriptors on Classes

## Key Ideas

- Descriptor access behaves differently when called on classes vs instances
- Class-level access passes `None` as the `instance` parameter to `__get__`
- `WeakKeyDictionary` cannot create weak references to `None`, causing errors
- The solution is to detect `instance is None` and return the descriptor object itself
- The `owner` parameter provides access to the containing class when needed

## The Problem: Class Attribute Access

We've seen that instance attribute retrieval works fine, but class attribute retrieval fails.

### Instance Access Works

```python
>>> mercury, venus, earth, mars = main()
>>> mars.radius_metres
3389500.0
```

### Class Access Fails

```python
>>> Planet.radius_metres
Traceback (most recent call last):
  File "<input>", line 1, in <module>
  File "/Users/rjs/training/tmp/advanced/planets/planet.py", line 10, in __get__
    return self._instance_data[instance]
  File "/Users/rjs/dev/virtualenvs/advanced-python/lib/python3.5/weakref.py", line 365, in __getitem__
    return self.data[ref(key)]
TypeError: cannot create weak reference to 'NoneType' object
```

### Why This Happens

When retrieving a descriptor from a class (rather than an instance), the `instance` argument of `__get__` is set to `None`. This causes a failure with `WeakKeyDictionary` because we cannot create a weak reference to `None`.

## The Solution: Detect Class Access

We can detect when a descriptor value is being retrieved via a class attribute by testing the `instance` argument against `None`.

### Updated `__get__` Implementation

```python
    def __get__(self, instance, owner):
        if instance is None:
            return self
        return self._instance_data[instance]
```

When `instance is None`, we return the descriptor object itself rather than performing the attribute lookup.

## Improved Behavior

With the revised code, we get more helpful behavior:

```python
>>> Planet.radius_metres
<planet.Positive object at 0x1032f9cc0>
```

Now accessing the descriptor through the class returns the descriptor object itself, which is the most natural behavior.

## Using the Owner Parameter

If you need to query or manipulate the class that contains the descriptor object, you can access it through the `owner` argument of the `__get__` method. In this case, `owner` contains a reference to the `Planet` class.

In many cases, you won't need to use `owner`, so you can ignore it as we've done in our implementation.

## Key Takeaways

- **Different access patterns**: Instance access retrieves values, class access should return the descriptor
- **None detection**: Check `if instance is None` to distinguish class from instance access
- **WeakKeyDictionary limitation**: Cannot create weak references to `None`
- **Natural behavior**: Returning `self` for class access follows Python conventions
- **Owner parameter**: Provides access to the containing class when needed
- **Graceful handling**: Proper implementation prevents confusing error messages
