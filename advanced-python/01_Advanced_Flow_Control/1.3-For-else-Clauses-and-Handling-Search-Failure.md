# 1.3 For-else Clauses and Handling Search Failure

# 1.3 For-else Clauses and Handling Search Failure

## Key Idea

- `for-else` works similarly to `while-else`: the `else` clause is the **"nobreak" clause**.
- Executes when the for loop **completes naturally** (including when iterable is empty).
- Skipped when the loop exits with `break`.
- Most useful pattern: **handling "not found" cases** in search operations.

## Behavior

- `else` clause executes when:
  - The for loop iterates through **all items** without breaking
  - The iterable is **empty** (no iterations occur)
- `else` clause is **skipped** when:
  - A `break` statement is executed

## Common Search Pattern

**Typical use case**: Search for an item that meets a condition

```python
for item in iterable:
    if condition(item):
        # Found it!
        break
else:  # nobreak - not found
    # Handle the "not found" case
    pass
```

## Practical Example: Ensuring Divisibility

**Problem**: Ensure a list contains at least one number divisible by a given value.

```python
def ensure_divisible(items, divisor):
    """Ensure list contains at least one number divisible by divisor."""
    
    for item in items:
        if item % divisor == 0:
            found = item
            break
    else:  # nobreak - no multiple found
        items.append(divisor)  # Add divisor itself
        print(f"Added {divisor} to ensure divisibility")
    
    return items
```

**Example usage**:
```python
numbers = [2, 5, 9, 37, 28, 14]
divisor = 12

# Are any divisible by 12? No.
ensure_divisible(numbers, divisor)
# Output: "Added 12 to ensure divisibility"
# numbers is now [2, 5, 9, 37, 28, 14, 12]
```

## When For-else Executes

### Case 1: Item Found (break executed)
```python
items = [1, 2, 3, 4, 5]
for item in items:
    if item == 3:
        print(f"Found {item}")
        break
else:
    print("Not found")  # This won't execute

# Output: "Found 3"
```

### Case 2: Item Not Found (loop completes)
```python
items = [1, 2, 4, 5]
for item in items:
    if item == 3:
        print(f"Found {item}")
        break
else:
    print("Not found")  # This executes

# Output: "Not found"
```

### Case 3: Empty Iterable
```python
items = []
for item in items:
    if item == 3:
        print(f"Found {item}")
        break
else:
    print("Not found")  # This executes

# Output: "Not found"
```

## Best Practices and Warnings

### Usage Frequency
- `for-else` is **more common** than `while-else`, but still rare.
- Both constructs are **widely misunderstood**.

### Readability Concerns
- **PyCon 2011 survey**: Majority of developers couldn't properly understand loop-else code.
- **Recommendation**: Use with caution and ensure team familiarity.
- Always add `# nobreak` comments for clarity.

### Alternative Approaches
Consider using explicit flags or functions for better readability:

```python
# Instead of for-else
def find_divisible(items, divisor):
    for item in items:
        if item % divisor == 0:
            return item
    return None

# Usage
found = find_divisible(numbers, 12)
if found is None:
    numbers.append(12)
```

## Key Takeaway

- `for-else` is most useful for **search failure handling**.
- The `else` clause executes when the search **fails to find** what you're looking for.
- Consider readability and team knowledge before using in production code.
