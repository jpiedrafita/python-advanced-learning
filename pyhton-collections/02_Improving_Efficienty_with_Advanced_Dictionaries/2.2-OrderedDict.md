# 2.2 OrderedDict

## 2.2.1 Understanding OrderedDict

- **OrderedDict**: The `OrderedDict` from the `collections` module is a dictionary subclass that maintains the order of keys as they were first inserted. Unlike standard Python dictionaries (in versions before Python 3.7). `OrderedDict` preserves the insertion order, allowing for ordered iterations and operations.

- **Creation**:
	- Empty instantiation: `OrderedDict()`.
    - From iterable of tuples.
    - From a regular dictionary.
    - Using keyword arguments.

```python
from collections import OrderedDict

print(issubclass(OrderedDict, dict))

# Creating an empty OrderedDict
od = OrderedDict()
print(od)

# Creating an OrderedDict with an iterable of items
od = OrderedDict([("key1", "value1"), ("key2", "value2")])
print(od)

# Creating an OrderedDict with a regular dictionary
od = OrderedDict({"key1": "value1", "key2": "value2"})
print(od)

# Creating an OrderedDict with keyword arguments
od = OrderedDict(key1="value1", key2="value2")
print(od)
```

Output:
```python
True
OrderedDict()
OrderedDict([('key1', 'value1'), ('key2', 'value2')])
OrderedDict([('key1', 'value1'), ('key2', 'value2')])
OrderedDict([('key1', 'value1'), ('key2', 'value2')])
```

- **Comparing `OrderedDict` instances**: Two OrderedDict instances are considered equal if they have the same keys in the same order and each key maps to the same value.

```python
from collections import OrderedDict

od1 = OrderedDict({"a": 1, "b": 2})
od2 = OrderedDict({"b": 2, "a": 1})
print(od1 == od2)
```

Output: `False`

- **Special methods**:
    - `move_to_end(key, last=True)`: moves a key to the end (or beginning if last=False).

	```python
	from collections import OrderedDict
	
	od = OrderedDict([("a", 1), ("b", 2), ("c", 3)])
	od.move_to_end("b") # Move "b" to the end
	print(od)
	
	od.move_to_end("b", last=False) # Move "b" to the beginning
	print(od)
	```

	Output:
	```python
	OrderedDict([('a', 1), ('c', 3), ('b', 2)])
	OrderedDict([('b', 2), ('a', 1), ('c', 3)])
	```


    - `popitem(last=True)`: removes the last item by default; set last=False to remove the first item.

	```python
	from collections import OrderedDict

	od = OrderedDict([("a", 1), ("b", 2), ("c", 3)])
	print(od)
	
	last_item = od.popitem()
	print(f"Popped last item: {last_item}")
	print(od)
	
	first_item = od.popitem(last=False)
	print(f"Popped first item: {first_item}")
	print(od)
	```

	Output:
	```python
	OrderedDict([('a', 1), ('b', 2), ('c', 3)])
	Popped last item: ('c', 3)
	OrderedDict([('a', 1), ('b', 2)])
	Popped first item: ('a', 1)
	OrderedDict([('b', 2)])
	```

## 2.2.2 Using OrderedDict

### Using Specific `OrderedDict` Operations

- **Managing sequences of operations**
    - Useful when order matters in tasks (e.g., ETL pipeline).
    - Can reorder with move_to_end and remove completed tasks with popitem.
        
```python
from collections import OrderedDict

operations = OrderedDict([
    ("clean_data", "Clean the loaded data"),
    ("load_data", "Load data from source"),
    ("analyze_data", "Analyze the cleaned data"),
    ("save_results", "Save analysis results")
])

# Prioritizing a specific operation to be evaluated first
operations.move_to_end("load_data", last=False)

# Running and removing the first operation
first_operation_key, _ = operations.popitem(last=False)
print(f"Running '{first_operation_key}' operation.")
```

Output
```python
Running 'load_data' operation.
```

### Testing Equality with Order in Mind

- **Order-sensitive comparisons**
    - Equality check also considers the **order of key-value pairs**. 
    - Useful for validating sequences (e.g., test phases).

```python
from collections import OrderedDict

# Expected sequence of A/B test phases
expected_sequence = OrderedDict([
    ("baseline", "Original version without changes"),
    ("change1", "Increased font size for better readability"),
    ("change2", "Changed call-to-action button color"),
    ("final", "Added customer testimonials")
])

# Actual sequence followed in one of the test setups
actual_sequence_test = OrderedDict([
    ("baseline", "Original version without changes"),
    ("change2", "Changed call-to-action button color"),
    ("change1", "Increased font size for better readability"),
    ("final", "Added customer testimonials")
])

# Function to compare the expected sequence with the actual one
def is_sequence_correct(expected, actual):
    return expected == actual

print("Test 1 sequence correct:", is_sequence_correct(expected_sequence, actual_sequence_test))
```

Output
```python
Test 1 sequence correct: False
```

### Backward Compatibility

- **Backward compatibility**
    - Ensures ordered behavior in Python versions <3.7 where dicts didnâ€™t guarantee insertion order.    
    - Handy when maintaining older codebases.